<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Predicción de Monto de Préstamo (Regresión Múltiple)</title>

  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <!-- Bootstrap Icons (opcional) -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    rel="stylesheet"
  />

  <style>
    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #0d6efd 0%, #4b91f7 35%, #f5f5f5 100%);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card {
      border-radius: 18px;
      overflow: hidden;
    }
    .card-header {
      background: #0d6efd;
      color: #fff;
      padding: 1rem 1.5rem;
    }
    .card-header h3 {
      margin: 0;
      font-weight: 600;
    }
    .card-body {
      padding: 1.8rem 1.8rem 1.5rem;
    }
    .result-box {
      font-size: 1.25rem;
      font-weight: 700;
    }
    .label-pill {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #e2e6ea;
    }
    code {
      font-size: 0.8rem;
      white-space: normal;
    }
  </style>
</head>
<body>
  <div class="container px-3">
    <div class="row justify-content-center">
      <div class="col-lg-7 col-md-9">
        <div class="card shadow-lg">
          <div class="card-header d-flex align-items-center justify-content-between">
            <div>
              <span class="label-pill d-block">Simulador de crédito · Regresión lineal</span>
              <h3 class="card-title mb-0">
                <i class="bi bi-graph-up-arrow me-2"></i>
                Predicción de Monto de Préstamo
              </h3>
            </div>
          </div>

          <div class="card-body">
            <!-- FORMULARIO -->
            <form onsubmit="event.preventDefault(); calcularPrediccion();">
              <div class="row g-3">
                <!-- Ingreso solicitante -->
                <div class="col-md-6">
                  <label for="ingreso_s" class="form-label">
                    Ingreso del solicitante
                    <span class="text-muted">(USD/mes)</span>
                  </label>
                  <div class="input-group">
                    <span class="input-group-text">USD $</span>
                    <input
                      type="number"
                      step="0.01"
                      class="form-control"
                      id="ingreso_s"
                      placeholder="Ej: 5000"
                      required
                    />
                  </div>
                </div>

                <!-- Ingreso cosolicitante -->
                <div class="col-md-6">
                  <label for="ingreso_co" class="form-label">
                    Ingreso del cosolicitante
                    <span class="text-muted">(USD/mes)</span>
                  </label>
                  <div class="input-group">
                    <span class="input-group-text">USD $</span>
                    <input
                      type="number"
                      step="0.01"
                      class="form-control"
                      id="ingreso_co"
                      placeholder="Ej: 2000"
                      required
                    />
                  </div>
                </div>

                <!-- Dependientes -->
                <div class="col-md-4 mt-3">
                  <label for="dependientes" class="form-label">
                    Dependientes
                  </label>
                  <input
                    type="number"
                    step="1"
                    min="0"
                    class="form-control"
                    id="dependientes"
                    placeholder="Ej: 2"
                    required
                  />
                </div>

                <!-- Plazo -->
                <div class="col-md-4 mt-3">
                  <label for="plazo" class="form-label">
                    Plazo del préstamo
                    <span class="text-muted">(meses)</span>
                  </label>
                  <input
                    type="number"
                    step="1"
                    min="0"
                    class="form-control"
                    id="plazo"
                    placeholder="Ej: 360"
                    required
                  />
                </div>

                <!-- Género -->
                <div class="col-md-4 mt-3">
                  <label for="genero" class="form-label">
                    Género
                  </label>
                  <select id="genero" class="form-select" required>
                    <option value="" selected disabled>Seleccione género...</option>
                    <option value="0">Femenino</option>
                    <option value="1">Masculino</option>
                  </select>
                </div>

                <!-- Historial de crédito -->
                <div class="col-md-6 mt-3">
                  <label class="form-label">
                    ¿Tiene historial de crédito?
                  </label>
                  <div class="d-flex gap-3">
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="radio"
                        name="historialRadio"
                        id="histSi"
                        value="1"
                        required
                      />
                      <label class="form-check-label" for="histSi">
                        Sí
                      </label>
                    </div>
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="radio"
                        name="historialRadio"
                        id="histNo"
                        value="0"
                        required
                      />
                      <label class="form-check-label" for="histNo">
                        No
                      </label>
                    </div>
                  </div>
                </div>
              </div>

              <button type="submit" class="btn btn-primary w-100 mt-4">
                <i class="bi bi-calculator me-1"></i>
                Calcular monto estimado
              </button>
            </form>

            <!-- RESULTADO -->
            <hr />
            <div id="resultado" class="alert alert-success mt-2 d-none">
              <p class="mb-1">
                <span class="result-box">
                  <i class="bi bi-cash-coin me-2"></i>
                  Monto de préstamo estimado:
                  <span id="montoEstimado"></span>
                  <span class="text-muted">(USD)</span>
                </span>
              </p>
              <small class="text-muted" id="detalleFormula"></small>
            </div>

            <!-- Botón detalles del modelo -->
            <button class="btn btn-link px-0 mt-2" type="button"
                    data-bs-toggle="collapse" data-bs-target="#panelModelo"
                    aria-expanded="false" aria-controls="panelModelo">
              <i class="bi bi-info-circle me-1"></i>
              Ver detalles del modelo (ecuación y métricas)
            </button>

            <!-- PANEL: ecuación + métricas -->
            <div class="collapse mt-2" id="panelModelo">
              <div class="alert alert-light border">
                <div class="mb-2">
                  <strong>Ecuación del modelo entrenado (train):</strong><br />
                  <code id="ecuacionTexto"></code>
                </div>
                <div class="mb-2">
                  <strong>Métricas en datos de prueba (test, en USD reales):</strong><br />
                  MSE test ≈ <code>3,016,974,902.82</code> &nbsp;·&nbsp;
                  MAE test ≈ <code>37,913.87 USD</code> &nbsp;·&nbsp;
                  R² test: <code>0.2350</code>
                </div>
                <div class="mb-1">
                  <strong>Métricas en entrenamiento (train):</strong><br />
                  MSE train ≈ <code>4,795,113,995.43</code> &nbsp;·&nbsp;
                  MAE train ≈ <code>45,187.39 USD</code> &nbsp;·&nbsp;
                  R² train: <code>0.3157</code>
                </div>
                <small class="text-muted">
                  El modelo explica aproximadamente el <strong>23.5&nbsp;%</strong>
                  de la variabilidad del monto del préstamo en datos de prueba.
                  El resto se debe a factores no incluidos y ruido en los datos.
                  Este simulador es solo para fines educativos y no debe usarse
                  para tomar decisiones reales de crédito.
                </small>
              </div>
            </div>

          </div> <!-- /card-body -->
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // ===== COEFICIENTES REALES DEL MODELO ENTRENADO (ESCALADO A USD) =====
    const B0 = 34677.82655601688;
    const B_Ingreso_Solicitante   = 6.370521093864328;
    const B_Ingreso_CoSolicitante = 5.97582671744226;
    const B_Dependientes          = 5033.815609259138;
    const B_Plazo_Prestamo        = 121.9354562979112;
    const B_Historial_Credito     = 10535.065692229973;
    const B_Genero_num            = 7444.361004657993;

    // Formateador de dinero en USD
    function formatUSD(value) {
      return value.toLocaleString("en-US", {
        style: "currency",
        currency: "USD",
        maximumFractionDigits: 2
      });
    }

    // Pintar ecuación del modelo
    function actualizarEcuacionTexto() {
      const ecuacion =
        `Monto_Prestamo = ${B0.toFixed(3)}`
        + ` + (${B_Ingreso_Solicitante.toFixed(6)} × Ingreso_Solicitante)`
        + ` + (${B_Ingreso_CoSolicitante.toFixed(6)} × Ingreso_CoSolicitante)`
        + ` + (${B_Dependientes.toFixed(6)} × Dependientes)`
        + ` + (${B_Plazo_Prestamo.toFixed(6)} × Plazo_Prestamo)`
        + ` + (${B_Historial_Credito.toFixed(6)} × Historial_Credito)`
        + ` + (${B_Genero_num.toFixed(6)} × Genero_num)`;
      document.getElementById("ecuacionTexto").textContent = ecuacion;
    }
    actualizarEcuacionTexto();

    function calcularPrediccion() {
      const ingresoS  = parseFloat(document.getElementById("ingreso_s").value);
      const ingresoCo = parseFloat(document.getElementById("ingreso_co").value);
      const dep       = parseFloat(document.getElementById("dependientes").value);
      const plazo     = parseFloat(document.getElementById("plazo").value);
      const generoStr = document.getElementById("genero").value;

      const histRadio = document.querySelector('input[name="historialRadio"]:checked');
      const histStr   = histRadio ? histRadio.value : "";

      if (
        isNaN(ingresoS) || isNaN(ingresoCo) ||
        isNaN(dep)      || isNaN(plazo)     ||
        generoStr === "" || histStr === ""
      ) {
        alert("Por favor completa todos los campos con valores válidos.");
        return;
      }

      const genero = parseFloat(generoStr);
      const hist   = parseFloat(histStr);

      // y = B0 + sum(Bi * Xi)
      const monto = B0
        + B_Ingreso_Solicitante   * ingresoS
        + B_Ingreso_CoSolicitante * ingresoCo
        + B_Dependientes          * dep
        + B_Plazo_Prestamo        * plazo
        + B_Historial_Credito     * hist
        + B_Genero_num            * genero;

      const resultadoDiv   = document.getElementById("resultado");
      const montoSpan      = document.getElementById("montoEstimado");
      const detalleFormula = document.getElementById("detalleFormula");

      montoSpan.textContent = formatUSD(monto);

      detalleFormula.textContent =
        `Cálculo: ${B0.toFixed(3)}`
        + ` + (${B_Ingreso_Solicitante.toFixed(6)} × ${ingresoS})`
        + ` + (${B_Ingreso_CoSolicitante.toFixed(6)} × ${ingresoCo})`
        + ` + (${B_Dependientes.toFixed(6)} × ${dep})`
        + ` + (${B_Plazo_Prestamo.toFixed(6)} × ${plazo})`
        + ` + (${B_Historial_Credito.toFixed(6)} × ${hist})`
        + ` + (${B_Genero_num.toFixed(6)} × ${genero})`
        + ` = ${formatUSD(monto)}`;

      resultadoDiv.classList.remove("d-none");
    }
  </script>
</body>
</html>
